// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

/// ========== ENUMS ==========

enum ProductStatus {
  ACTIVE
  INACTIVE
  DRAFT
  ARCHIVED
}

enum CouponType {
  PERCENTAGE
  FIXED
}

enum CouponStatus {
  ACTIVE
  INACTIVE
  EXPIRED
}

enum CouponTarget {
  PRODUCT
  CATEGORY
  SHOP
  CART
}

/// ========== MODELS ==========

model Category {
  id          String     @id @default(uuid())
  name        String
  slug        String
  fullSlug    String     @unique
  description String?
  summary     String?
  icon        String?

  parentId    String?    
  parent      Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children    Category[] @relation("CategoryHierarchy")

  products    Product[]

  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

model Brand {
  id        String    @id @default(uuid())
  name      String    @unique
  slug      String    @unique
  logoUrl   String?

  products  Product[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model Product {
  id             String         @id @default(uuid())
  title          String
  slug           String         @unique
  description    String?
  summary        String?

  price          Float?
  compareAtPrice Float?
  sku            String?
  stock          Int            @default(0)
  inStock        Boolean        @default(true)

  status         ProductStatus  @default(ACTIVE)

  shopId         String         // stores Mongo Shop _id
  categoryId     String
  brandId        String?

  category       Category       @relation(fields: [categoryId], references: [id])
  brand          Brand?         @relation(fields: [brandId], references: [id])

  variants       ProductVariant[]

  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
}

model ProductVariant {
  id              String        @id @default(uuid())
  productId       String
  attributes      Json?
  sku             String?       @unique
  price           Float?
  compareAtPrice  Float?
  stock           Int           @default(0)
  status          ProductStatus @default(ACTIVE)

  product         Product       @relation(fields: [productId], references: [id])

  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
}

model Coupon {
  id           String        @id @default(uuid())
  code         String        @unique
  type         CouponType
  value        Float
  appliesTo    CouponTarget?
  minOrder     Float?
  usageLimit   Int?
  usedCount    Int           @default(0)
  perUserLimit Int?
  startAt      DateTime?
  expiresAt    DateTime?
  status       CouponStatus  @default(ACTIVE)

  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}
